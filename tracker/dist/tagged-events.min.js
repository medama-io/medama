!function(){if(!document)return;const t=document.currentScript,e=t.getAttribute("data-api")?`${location.protocol}//${t.getAttribute("data-api")}`:t.src.replace(/[^\/]+$/,"api/"),n=()=>Date.now().toString(36)+Math.random().toString(36).substr(2);let a=n(),o=!0,i=0,r=Date.now(),s=!1;const c=history.pushState,d=history.replaceState,p=()=>{o=!1,a=n(),i=0,r=Date.now(),s=!1},h=t=>function(e,n,a){a&&location.pathname!==new URL(a,location.href).pathname?(m(),p(),t.apply(this,arguments),u()):t.apply(this,arguments)},l=t=>new Promise((e=>{const n=new XMLHttpRequest;n.onload=()=>{e(0==n.responseText)},n.open("GET",t),n.setRequestHeader("Content-Type","text/plain"),n.send()})),u=async()=>{l(e+"event/ping?u="+encodeURIComponent(location.host+location.pathname)).then((t=>{fetch(e+"event/hit",{method:"POST",body:JSON.stringify({b:a,e:"load",u:location.href,r:document.referrer,p:o,q:t,t:Intl.DateTimeFormat().resolvedOptions().timeZone}),mode:"no-cors"})}))},m=()=>{s||navigator.sendBeacon(e+"event/hit",JSON.stringify({b:a,e:"unload",m:Date.now()-r})),s=!0},g=t=>{if(t.button>1)return;const n=t.target instanceof HTMLElement?t.target.closest("[data-medama-*]"):null;if(!n)return;const o=Object.fromEntries([...n.attributes].filter((t=>t.name.startsWith("data-medama-"))).map((t=>[t.name.slice(12),t.value])));var i;Object.keys(o).length>0&&(i=o,fetch(e+"event/hit",{method:"POST",body:JSON.stringify({b:a,e:"custom",g:location.hostname,d:i}),mode:"no-cors"}))};addEventListener("click",g),addEventListener("auxclick",g),"onpagehide"in self?addEventListener("pagehide",m,{capture:!0}):(addEventListener("beforeunload",m,{capture:!0}),addEventListener("unload",m,{capture:!0})),addEventListener("visibilitychange",(()=>{"hidden"==document.visibilityState?i=Date.now():(r+=Date.now()-i,i=0)}),{capture:!0}),l(e+"event/ping?root").then((e=>{o=e,u(),t.getAttribute("data-hash")?addEventListener("hashchange",u,{capture:!0}):(history.pushState=h(c),history.replaceState=h(d),addEventListener("popstate",(()=>{m(),p(),u()}),{capture:!0}))}))}();