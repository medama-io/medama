const t="unload";!function(){if(!document)return;const e=document.currentScript,n=e.getAttribute("data-api")?`${document.location.protocol}//${e.getAttribute("data-api")}`:e.src.replace(/[^\/]+$/,"api/"),a=()=>Date.now().toString(36)+Math.random().toString(36).substr(2);let o=a(),i=!0,r=0,s=Date.now(),c=!1;const d=history.pushState,p=history.replaceState,h=()=>{i=!1,o=a(),r=0,s=Date.now(),c=!1},u=t=>function(e,n,a){a&&location.pathname!==new URL(a,location.href).pathname?(g(),h(),t.apply(this,arguments),m()):t.apply(this,arguments)},l=t=>new Promise((e=>{const n=new XMLHttpRequest;n.onload=()=>{e(0==n.responseText)},n.open("GET",t),n.setRequestHeader("Content-Type","text/plain"),n.send()})),m=async()=>{l(n+"event/ping?u="+encodeURIComponent(location.host+location.pathname)).then((t=>{fetch(n+"event/hit",{method:"POST",body:JSON.stringify({b:o,e:"load",u:location.href,r:document.referrer,p:i,q:t,t:Intl.DateTimeFormat().resolvedOptions().timeZone}),mode:"no-cors"})}))},g=()=>{c||navigator.sendBeacon(n+"event/hit",JSON.stringify({b:o,e:t,m:Date.now()-s})),c=!0};"onpagehide"in self?addEventListener("pagehide",g,{capture:!0}):(addEventListener("beforeunload",g,{capture:!0}),addEventListener(t,g,{capture:!0})),addEventListener("visibilitychange",(()=>{"hidden"==document.visibilityState?r=Date.now():(s+=Date.now()-r,r=0)}),{capture:!0}),l(n+"event/ping?root").then((t=>{i=t,m(),e.getAttribute("data-hash")?addEventListener("hashchange",m,{capture:!0}):(history.pushState=u(d),history.replaceState=u(p),addEventListener("popstate",(()=>{g(),h(),m()}),{capture:!0}))}))}();